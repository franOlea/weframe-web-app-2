<template>
  <require from="../../date-format"></require>
  <require from="../../purchase-value-format"></require>
  <div class="text-center" if.bind="working">
    <div class="spinner-grow" style="width: 30rem; height: 30rem;" role="status">
      <span class="sr-only">Loading...</span>
    </div>
  </div>
  <select class="form-control" value.bind="statusFilter" change.delegate="updatePurchaseList(currentPage, AdminPurchaseList.PAGE_SIZE, statusFilter)" disabled.bind="working">
    <option>-</option>
    <option>PENDING</option>
    <option>MAKING</option>
    <option>SHIPPING</option>
    <option>COMPLETE</option>
    <option>CANCELLED</option>
    <option>REJECTED</option>
    <option>ERROR</option>
  </select>
  <div class="alert alert-danger" role="alert" if.bind="!working && error">
    <strong>${error.title}</strong> ${error.message}
    <button type="button" class="close" data-dismiss="alert" aria-label="Close" click.trigger="created()">
      <span aria-hidden="true"><i class="fas fa-sync-alt"></i></span>
    </button>
  </div>
  <table class="table" if.bind="!working">
    <thead>
    <tr>
      <th scope="col">Cliente</th>
      <th scope="col">Momento de compra</th>
      <th scope="col">Marco</th>
      <th scope="col">Panel anterior</th>
      <th scope="col">Panel posterior</th>
      <th scope="col">Valor</th>
      <th scope="col">Estado de transacci√≥n</th>
      <th scope="col">Estado de compra</th>
      <th scope="col">Numero de compra</th>
      <th scope="col"><i class="fas fa-info"></i> Detalles</th>
    </tr>
    </thead>
    <tbody>
    <tr repeat.for="purchase of purchases">
      <td>${purchase.user}</td>
      <td>${purchase.stampDatetime | dateFormat}</td>
      <td>${purchase.frame.name}</td>
      <td>${purchase.backboard.name}</td>
      <td>${purchase.frontMat.name}</td>
      <td>${purchase | purchaseValueFormat}</td>
      <td>${purchase.transactionStatus}</td>
      <td>
        <select class="form-control" value.bind="purchase.status" change.delegate="purchaseStatusChanged(purchase, $event)">
          <option>PENDING</option>
          <option>MAKING</option>
          <option>SHIPPING</option>
          <option>COMPLETE</option>
          <option>CANCELLED</option>
          <option>REJECTED</option>
          <option>ERROR</option>
        </select>
      </td>
      <td>${purchase.id}</td>
      <td>
        <button type="button" class="btn btn-info" data-toggle="modal" data-target="#purchaseDetailModal" click.delegate="select(purchase)">
          <i class="fas fa-info"></i>
        </button>
      </td>
    </tr>
    </tbody>
  </table>

  <nav aria-label="Admin purchase list" if.bind="!working">
    <ul class="pagination justify-content-center">
      <li class="page-item ${hasPrevious ? '' : 'disabled'}">
        <button class="page-link" class="page-link" click.delegate="loadPrevious()">Previous</button>
      </li>
      <li class="page-item ${hasMore ? '' : 'disabled'}">
        <button class="page-link" class="page-link" click.delegate="loadNext()">Next</button>
      </li>
    </ul>
  </nav>

  <!-- Modal -->
  <div class="modal fade" id="purchaseDetailModal" tabindex="-1" role="dialog" aria-labelledby="purchaseDetailModal" aria-hidden="true" data-keyboard="false" data-backdrop="static">>
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-body">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close" click.delegate="deselect()"><span aria-hidden="true">&times;</span></button>
          <div class="row">
            <button type="button" class="btn btn-info" click.trigger="download()" disabled.bind="downloading">
              Descargar imagen
            </button>
          </div>
          <div class="row">
            <div class="card" style="width: 18rem;">
              <img src="${selectedPurchase.frame.picture.url}" class="card-img-top" alt="${selectedPurchase.frame.name}">
              <div class="card-body">
                <h5 class="card-title">${selectedPurchase.frame.name}</h5>
              </div>
            </div>
            <div class="card" style="width: 18rem;">
              <img src="${selectedPurchase.backboard.picture.url}" class="card-img-top" alt="${selectedPurchase.backboard.name}">
              <div class="card-body">
                <h5 class="card-title">${selectedPurchase.backboard.name}</h5>
              </div>
            </div>
            <div class="card" style="width: 18rem;">
              <img src="${selectedPurchase.frontMat.picture.url}" class="card-img-top" alt="${selectedPurchase.frontMat.name}">
              <div class="card-body">
                <h5 class="card-title">${selectedPurchase.frontMat.name}</h5>
              </div>
            </div>
            <div class="card" style="width: 18rem;">
              <img src="${selectedPurchase.userPicture.picture.url}" class="card-img-top" alt="${selectedPurchase.userPicture.picture.name}">
              <div class="card-body">
                <h5 class="card-title">${selectedPurchase.userPicture.picture.name}</h5>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>