<template>
  <require from="../../date-format"></require>
  <require from="../../purchase-value-format"></require>
  <require from="./purchase-status-format"></require>
  <div style="overflow-y: scroll; overflow-x: hidden; height:100%; -webkit-overflow-scrolling: touch;">
    <div class="text-center" if.bind="working">
      <div class="spinner-grow" style="width: 30rem; height: 30rem;" role="status">
        <span class="sr-only">Loading...</span>
      </div>
    </div>
    <table class="table" if.bind="!working">
      <thead>
        <tr>
          <th scope="col">Imagen</th>
          <th scope="col">Momento de compra</th>
          <th scope="col">Marco</th>
          <th scope="col">Panel anterior</th>
          <th scope="col">Panel posterior</th>
          <th scope="col">Pantalla</th>
          <th scope="col">Valor</th>
          <th scope="col">Estado de compra</th>
          <th scope="col">Numero de compra</th>
          <th scope="col"><i class="fas fa-info"></i> Detalles</th>
        </tr>
      </thead>
      <tbody>
        <tr repeat.for="purchase of purchases">
          <td if.bind="purchase.userPicture">${purchase.userPicture.picture.name}</td>
          <td if.bind="!purchase.userPicture">Imagen Borrada</td>
          <td>${purchase.stampDatetime | dateFormat}</td>
          <td>${purchase.frame.name}</td>
          <td>${purchase.backboard.name}</td>
          <td>${purchase.frontMat.name}</td>
          <td>${purchase.frameGlass.name}</td>
          <td>${purchase | purchaseValueFormat}</td>
          <td>${purchase.status | purchaseStatusFormat}</td>
          <td>${purchase.id}</td>
          <td>
            <button type="button" class="btn btn-info" data-toggle="modal" data-target="#purchaseDetailModal" click.delegate="select(purchase)">
              <i class="fas fa-info"></i>
            </button>
          </td>
        </tr>
      </tbody>
    </table>
    <nav aria-label="Admin purchase list" if.bind="!working">
      <ul class="pagination justify-content-center">
        <li class="page-item ${hasPrevious ? '' : 'disabled'}">
          <button class="page-link" class="page-link" click.delegate="loadPrevious()">Previous</button>
        </li>
        <li class="page-item ${hasMore ? '' : 'disabled'}">
          <button class="page-link" class="page-link" click.delegate="loadNext()">Next</button>
        </li>
      </ul>
    </nav>
    <div class="modal fade" id="purchaseDetailModal" tabindex="-1" role="dialog" aria-labelledby="purchaseDetailModal" aria-hidden="true" data-keyboard="false" data-backdrop="static">>
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-body">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close" click.delegate="deselect()"><span aria-hidden="true">&times;</span></button>
            <div class="row">
              <div class="col-12">
                <p class="text-left">${selectedPurchase.streetAddressOne}</p>
                <p class="text-left">${selectedPurchase.streetAddressTwo}</p>
                <p class="text-left">${selectedPurchase.zipCode}</p>
                <p class="text-left">${selectedPurchase.province}</p>
                <p class="text-left">${selectedPurchase.locality}</p>
              </div>
            </div>
            <hr>
            <div class="row">
              <h5 class="card-title" if.bind="!selectedPurchase.userPicture">Imagen Borrada</h5>
              <button type="button" class="btn btn-info" click.trigger="download()" disabled.bind="downloading" if.bind="selectedPurchase.userPicture">
                Descargar imagen
              </button>
            </div>
            <hr>
            <div class="row">
              <div class="card" style="width: 18rem;">
                <img src="${selectedPurchase.frame.picture.url}" class="card-img-top" alt="${selectedPurchase.frame.name}">
                <div class="card-body">
                  <h5 class="card-title">${selectedPurchase.frame.name}</h5>
                </div>
              </div>
              <div class="card" style="width: 18rem;">
                <img src="${selectedPurchase.backboard.picture.url}" class="card-img-top" alt="${selectedPurchase.backboard.name}">
                <div class="card-body">
                  <h5 class="card-title">${selectedPurchase.backboard.name}</h5>
                </div>
              </div>
              <div class="card" style="width: 18rem;">
                <img src="${selectedPurchase.frontMat.picture.url}" class="card-img-top" alt="${selectedPurchase.frontMat.name}">
                <div class="card-body">
                  <h5 class="card-title">${selectedPurchase.frontMat.name}</h5>
                </div>
              </div>
              <div class="card" style="width: 18rem;">
                <img src="${selectedPurchase.userPicture.picture.url}" class="card-img-top" alt="${selectedPurchase.userPicture.picture.name}" if.bind="selectedPurchase.userPicture">
                <div class="card-body">
                  <h5 class="card-title" if.bind="selectedPurchase.userPicture">${selectedPurchase.userPicture.picture.name}</h5>
                  <h5 class="card-title" if.bind="!selectedPurchase.userPicture">Imagen Borrada</h5>
                </div>
              </div>
              <div class="card" style="width: 18rem;">
                <div class="card-body">
                  <h5 class="card-title">${selectedPurchase.frameGlass.name}</h5>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>